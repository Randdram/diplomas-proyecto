<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or "🎓 Portal Escolar · Verificación de Diplomas" }}</title>
  <link rel="stylesheet" href="/static/styles.css" />
  <script>
    function updateAction(input) {
        const form = input.form;
        const folio = input.value.trim();
        if (folio) {
            form.action = `/verificar/${encodeURIComponent(folio)}`;
        } else {
            form.action = '/verificar';
        }
    }
    
    function handleFolioSubmit(event) {
        event.preventDefault();
        const form = event.target;
        const folioInput = form.querySelector('input[name="folio"]');
        const folio = folioInput.value.trim();
        
        if (folio) {
            window.location.href = `/verificar/${encodeURIComponent(folio)}`;
        }
    }
  </script>
</head>
<body>
  <div class="background-animation"></div>
  
  <nav class="nav">
    <div class="wrap">
      <div class="brand">
        <div class="logo">🎓</div>
        <div class="title">PortalEscolar</div>
      </div>
      <div class="links">
        <a href="/ingresar">👤 Alumnos</a>
        <a href="/docs" target="_blank" rel="noopener">🔧 API</a>
      </div>
    </div>
  </nav>

  <main class="wrap">
    <section class="hero floating">
      <h1>Verificación de Diplomas</h1>
      <p>🎉 Consulta, valida y descarga tus reconocimientos académicos</p>
    </section>

    <!-- Verificar por folio -->
    <section class="card">
      <h3>🔍 Verificar por folio</h3>
      <form onsubmit="handleFolioSubmit(event)" style="display: flex; gap: 10px; align-items: center;">
        <input
          type="text"
          name="folio"
          placeholder="📝 Escribe tu folio aquí..."
          required
          style="flex: 1;"
          oninput="updateAction(this)"
        />
        <button class="btn brand" type="submit">✨ Verificar</button>
      </form>
      <p class="muted" style="margin-top: 10px;">Ejemplo: 7cdf9138-0bb2-4d4f-8100-175b40b220b8</p>
    </section>

    <!-- Acceso alumnos -->
    <section class="card">
      <h3>👥 Portal de Alumnos</h3>
      <p>¿No recuerdas tu folio? Entra con tu CURP y descarga tus diplomas.</p>
      <a class="btn brand" href="/ingresar">🚀 Entrar al Portal</a>
    </section>

    <!-- Herramientas admin -->
    {% if token %}
    <section class="card">
      <h3>🛠️ Herramientas de Administración</h3>
      <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a class="btn" href="/admin/generar?token={{ token }}">📄 Generar PDFs</a>
        <a class="btn" href="/admin/sync-auto?token={{ token }}">🔄 Sincronización Automática</a>
        <a class="btn" href="/admin/sync?token={{ token }}">☁️ Sincronizar Supabase</a>
        <a class="btn" href="/pdfs-list">📋 Ver Índice</a>
      </div>
      <p class="muted">🔒 Solo visible con token de administrador válido</p>
    </section>
    {% endif %}
  </main>

  <footer>
    <div class="wrap">
      <small>© {{ (now or 2025) }} Portal Escolar · Verificación de Diplomas · Hecho con ❤️</small>
      {% if token %}
      <br><small class="muted">Token: {{ token[:8] }}... (Admin activo)</small>
      {% endif %}
    </div>
  </footer>
</body>
</html>