<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or "Portal de Alumnos" }}</title>
  
  <!-- Google Fonts: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <div class="background-animation"></div>
  
  <nav class="nav">
    <div class="wrap">
      <a href="/" class="brand">
        <div class="logo">🎓</div>
        <div class="title">PortalEscolar</div>
      </a>
      <div class="links">
        <a href="/ingresar">Alumnos</a>
        <a href="/admin-login">Admin</a>
      </div>
    </div>
  </nav>

  <main class="wrap">
    <section class="hero">
      <h1>Portal de Alumnos</h1>
      <p class="muted">Consulta tus diplomas por CURP y descárgalos.</p>
    </section>

    <section class="card">
      <form method="get" action="/ingresar" class="grid-form" autocomplete="off">
        <input
          type="text"
          name="curp"
          placeholder="ESCRIBE TU CURP"
          value="{{ curp or '' }}"
          required
        />
        <button class="btn brand" type="submit">Buscar</button>
      </form>
    </section>

    {% if curp %}
    <section class="card" style="margin-top:18px;">
      <h3 style="margin-top:0;">Resultados para: <code>{{ curp }}</code></h3>

      {% if diplomas and diplomas|length > 0 %}
      <!--
        ===============================================
        AQUÍ ESTÁ LA SOLUCIÓN PARA MÓVILES
        Este div permite que la tabla se desplace
        horizontalmente si no cabe en la pantalla.
        ===============================================
      -->
      <div class="table-container">
        <table class="results-table">
          <thead>
            <tr>
              <th>Curso</th>
              <th>Folio</th>
              <th>Estado</th>
              <th>Fecha emisión</th>
              <th>PDF</th>
            </tr>
          </thead>
          <tbody>
          {% for d in diplomas %}
            <tr>
              <td>{{ d.curso or '—' }}</td>
              <td>
                <a href="/verificar/{{ d.folio }}" style="color: var(--primary-light); text-decoration: none;">
                    <code>{{ d.folio[:8] }}...</code>
                </a>
              </td>
              <td>
                {% if d.estado == 'VALIDO' %}
                  <span class="tag ok">Válido</span>
                {% else %}
                  <span class="tag bad">{{ d.estado }}</span>
                {% endif %}
              </td>
              <td>{{ (d.fecha_emision|string)[:10] }}</td>
              <td>
                {% if d.pdf_url %}
                  <a class="btn" href="{{ d.pdf_url }}" target="_blank" rel="noopener">Descargar</a>
                {% else %}
                  <span class="muted">No disponible</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p class="muted" style="margin:10px 0 0;">No se encontraron diplomas para esta CURP.</p>
      {% endif %}
    </section>
    {% endif %}
  </main>

  <footer>
    <div class="wrap">
      <small class="muted">© {{ now }} Portal Escolar · Verificación de Diplomas</small>
    </div>
  </footer>
</body>
</html>
